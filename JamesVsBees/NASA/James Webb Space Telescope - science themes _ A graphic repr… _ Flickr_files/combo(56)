YUI.add("hermes-template-scrollable-comment-list-view",function(e,a){var s=e.Template.Handlebars.revive({compiler:[7,">= 4.0.0"],main:function(e,a,s,t,l){var n=null!=a?a:{},i=s.helperMissing,m=e.escapeExpression;return'<div class="comment-list-container loading">\n\t<ol class="comment-list">\n\t</ol>\n\t<div class="loading-text">'+m((s.intlMessage||a&&a.intlMessage||i).call(n,{name:"intlMessage",hash:{intlName:"comments.LOADING_COMMENTS"},data:l}))+'</div>\n\t<div class="no-comments-text">'+m((s.intlMessage||a&&a.intlMessage||i).call(n,{name:"intlMessage",hash:{intlName:"comments.NO_COMMENTS"},data:l}))+"</div>\n</div>"},useData:!0}),t={};e.Array.each([],function(a){var s=e.Template.get("hermes/"+a);s&&(t[a]=s)}),e.Template.register("hermes/scrollable-comment-list-view",function(a,l){return l=l||{},l.partials=l.partials?e.merge(t,l.partials):t,s(a,l)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("scrollable-comment-list-view",function(t,e){var s=require("hermes-core/flog")(e);t.namespace("Views")[this.name]=t.Base.create(this.name,t.Views["comment-list-view"],[],{langBundles:this.details.langBundles,initializer:function(t){this.constructor.superclass.initializer.call(this,t),this.listRegistryName=t.commentListConfig.listRegistryName,this.listId=t.commentListConfig.modelId},loadState:function(){var t=this;return t.appContext.getModel(t.listRegistryName,{id:t.listId}).then(function(e){t.commentListModel=e}).catch(function(t){throw s.error("Error getting comment list info",{err:t}),t})},buildContainer:function(){this.setContainerWithTemplate("scrollable-comment-list-view",this.params)},activate:function(){var t=this.get("container");this.listContainerNode=t.one(".comment-list-container"),this.scrollableEl=this.listContainerNode.getDOMNode(),this.registerEventHandler(this.commentListModel.on("valuesChanged",this.handleCommentListChange.bind(this),!0)),this.constructor.superclass.activate.call(this)},handleCommentListChange:function(t){0===t.comments.newVal.getList().length?this.showNoCommentsMessage():this.listContainerNode.removeClass("no-comments")},showNoCommentsMessage:function(){var t=this;this.listContainerNode.addClass("no-comments"),setTimeout(function(){t.fire("subviewViewEvent",{eventName:"emptyCommentContainer"})},300)},getNumOfComments:function(){return this.commentListModel.getValue(this.params.commentListConfig.collectionName).getList().length},setLoading:function(t){this.isLoading=t,this.listContainerNode.toggleClass("loading",t)},handleLoadCommentsComplete:function(){this.listContainerNode.removeClass("loading"),0===this.getNumOfComments()&&this.showNoCommentsMessage(),this.scrollableEl.scrollTop=this.scrollableEl.scrollHeight,this.registerEventHandler(this.listContainerNode.on("scroll",this.handleCommentsScroll.bind(this)))},appendNewComment:function(t){0===this.getNumOfComments()&&this.listContainerNode.removeClass("no-comments"),this.constructor.superclass.appendNewComment.call(this,t)},handleCommentsScroll:function(t){!this.isFetchingComments&&this.scrollableEl.scrollTop<=0&&this.getMoreComments()},showCommentLoading:function(t){t?this.showBalls(!1):this.hideBalls()},showCommentAddLoading:function(t){t?(this.showBalls(!0),this.scrollableEl.scrollTop=this.scrollableEl.scrollHeight):this.hideBalls()},handleCommentViewAppended:function(t){this.scrollableEl.scrollTop=this.scrollableEl.scrollHeight},updateComments:function(t){var e=this;return t.forEach(function(t){e.renderedCommentModels.push(t)}),this.prependComments(t)},prependComments:function(e){var s=this,i=[],n=[];return e.forEach(function(e){var o=e.toJSON(),l=Object.assign(o,{appContext:this.appContext});l.isSubjectOwner=s.isSubjectOwner;var a=new t.Views["comment-item-view"](l),m=a.initialize(l).then(function(){a.activate()});n.push(a),i.push(m)}),t.Promise.all(i).then(function(){s.prependCommentViewsToDom(n)})},prependCommentViewsToDom:function(e){var s,i=this,n=this.scrollableEl,o=n.scrollHeight,l=n.scrollTop;e.forEach(function(e){(s=t.Node.create('<li class="comment-list-item"></li>')).append(e.get("container")),i.commentsListNode.prepend(s)}),n.scrollTop=n.scrollHeight-o+l}})},"@VERSION@",{requires:["flickr-view","comment-list-view","hermes-template-scrollable-comment-list-view"],langBundles:["common","comments"]});YUI.add("hermes-template-photo-comments-view",function(e,t){var a=e.Template.Handlebars.revive({compiler:[7,">= 4.0.0"],main:function(e,t,a,n,s){var l=null!=t?t:{},o=a.helperMissing,i=e.escapeExpression;return'<section class="comments-list-section">\n\t'+i((a.outlet||t&&t.outlet||o).call(l,null!=t?t["scrollable-comment-list-view"]:t,{name:"outlet",hash:{},data:s}))+'\n</section>\n\n<section class="add-comment-section">\n\t'+i((a.outlet||t&&t.outlet||o).call(l,null!=t?t["add-comment-view"]:t,{name:"outlet",hash:{},data:s}))+"\n</section>\n"},useData:!0}),n={};e.Array.each([],function(t){var a=e.Template.get("hermes/"+t);a&&(n[t]=a)}),e.Template.register("hermes/photo-comments-view",function(t,s){return s=s||{},s.partials=s.partials?e.merge(n,s.partials):n,a(t,s)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("hermes-template-comment-edit",function(t,e){var n=t.Template.Handlebars.revive({compiler:[7,">= 4.0.0"],main:function(t,e,n,a,s){var i,l=null!=e?e:{},m=n.helperMissing,o=t.escapeExpression;return'<div class="comment-edit">\n\t<textarea class="edit-field">'+o("function"==typeof(i=null!=(i=n.content||(null!=e?e.content:e))?i:m)?i.call(l,{name:"content",hash:{},data:s}):i)+'</textarea>\n\t<div class="buttons edit-comment-buttons">\n\t\t<button type="button" class="mini alt cancel-edit-button">'+o((n.intlMessage||e&&e.intlMessage||m).call(l,{name:"intlMessage",hash:{intlName:"common.CANCEL"},data:s}))+'</button>\n\t\t<button type="button" class="mini action submit-edit-button">'+o((n.intlMessage||e&&e.intlMessage||m).call(l,{name:"intlMessage",hash:{intlName:"common.DONE"},data:s}))+"</button>\n\t</div>\n</div>"},useData:!0}),a={};t.Array.each([],function(e){var n=t.Template.get("hermes/"+e);n&&(a[e]=n)}),t.Template.register("hermes/comment-edit",function(e,s){return s=s||{},s.partials=s.partials?t.merge(a,s.partials):a,n(e,s)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("photo-comments-view",function(e,t){require("hermes-core/flog")(t);e.namespace("Views")[this.name]=e.Base.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){this.params=e,this.params.commentListConfig={type:"photo",listRegistryName:"photo-comments-models",modelId:e.photoId,collectionName:"comments",commentModelRegistryName:"comment-models"},this.params.addCommentConfig={type:"photo",commentModelRegistryName:"comment-models",addCommentText:e.addCommentText||this.intlMessage({intlName:"comments.ADD_PHOTO_COMMENT",mediaType:"photo"})},this.commentsPage=0,this.signedIn=this.appContext.getViewer().signedIn},subviewConfig:{"scrollable-comment-list-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!1},"add-comment-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!1}},loadState:function(){var t=this,o=[this.appContext.getModelRegistry("comment-models").then(function(e){t.commentModelRegistry=e}),this.appContext.getModel("photo-engagement-models",this.params.photoId).then(function(e){this.engagementModel=e}.bind(this)),this.appContext.getModel(this.params.commentListConfig.listRegistryName,this.params.commentListConfig.modelId).then(function(e){t.listModel=e})];return this.signedIn&&o.push(this.appContext.getModel("person-models",{id:this.appContext.getViewer().nsid}).then(function(e){t.userModel=e})),e.Promise.all(o)},buildContainer:function(){this.setContainerWithTemplate("photo-comments-view",{user:this.signedIn?this.userModel.toJSON():null,signedIn:this.signedIn})},activate:function(){this.get("container");this.commentListView=this.subviews["scrollable-comment-list-view"],this.addCommentView=this.subviews["add-comment-view"]},delayPromise:function(t,o){return new e.Promise(function(e){setTimeout(function(){return e(o())},t)})},onSubviewEvent:function(t,o){var n;if(o&&o[0])switch((n=o[0]).eventName){case"replyClicked":this.addCommentView.addReplyMessage(n.pathAliasOrNSID,!1);break;case"emptyCommentContainer":this.addCommentView.focusCommentBox();break;case"commentAddLoading":e.rapidTracker.beacon(this.name,"galleryPhotoCommentAddClick"),this.commentListView.showCommentAddLoading(n.isLoading);break;case"commentAdded":this.commentListView.appendNewComment(n.commentModel),this.listModel.getValue(this.params.commentListConfig.collectionName).prependToList(n.commentModel),this.engagementModel.setValue("commentCount",this.engagementModel.getValue("commentCount")+1);break;case"commentDeleted":this.listModel.getValue(this.params.commentListConfig.collectionName).removeFromList(n.commentModelId),this.engagementModel.setValue("commentCount",this.engagementModel.getValue("commentCount")-1)}}})},"@VERSION@",{requires:["flickr-view","comment-item-view","add-comment-view","scrollable-comment-list-view","hermes-template-photo-comments-view","hermes-template-comment-edit"],langBundles:["gallery","stats","comments","common"]});YUI.add("hermes-template-add-to-stuff-view",function(t,a){var e=t.Template.Handlebars.revive({1:function(t,a,e,n,l){return'\t\t\t\t<li role="button" class="tab-item album-tab selected" data-tab="album" tabindex="0">\n\t\t\t\t\t<span>'+t.escapeExpression((e.intlMessage||a&&a.intlMessage||e.helperMissing).call(null!=a?a:{},{name:"intlMessage",hash:{intlName:"common.ALBUMS"},data:l}))+"</span>\n\t\t\t\t</li>\n"},3:function(t,a,e,n,l){return'\t\t\t\t<li role="button" class="tab-item gallery-tab" data-tab="gallery" tabindex="0">\n\t\t\t\t\t<span>'+t.escapeExpression((e.intlMessage||a&&a.intlMessage||e.helperMissing).call(null!=a?a:{},{name:"intlMessage",hash:{intlName:"common.GALLERIES"},data:l}))+"</span>\n\t\t\t\t</li>\n"},5:function(t,a,e,n,l){return'\t\t\t\t<li role="button" class="tab-item group-tab" data-tab="group" tabindex="0">\n\t\t\t\t\t<span>'+t.escapeExpression((e.intlMessage||a&&a.intlMessage||e.helperMissing).call(null!=a?a:{},{name:"intlMessage",hash:{intlName:"common.GROUPS"},data:l}))+"</span>\n\t\t\t\t</li>\n"},7:function(t,a,e,n,l){var s=null!=a?a:{},i=e.helperMissing,o=t.escapeExpression;return'\t\t\t<div class="tab-container selected" data-tab="album">\n\t\t\t\t'+o((e.outlet||a&&a.outlet||i).call(s,null!=a?a["album-selection-view"]:a,{name:"outlet",hash:{},data:l}))+"\n\t\t\t\t"+o((e.outlet||a&&a.outlet||i).call(s,null!=a?a["album-creation-view"]:a,{name:"outlet",hash:{},data:l}))+"\n\t\t\t</div>\n"},9:function(t,a,e,n,l){var s=null!=a?a:{},i=e.helperMissing,o=t.escapeExpression;return'\t\t\t<div class="tab-container" data-tab="gallery">\n\t\t\t\t'+o((e.outlet||a&&a.outlet||i).call(s,null!=a?a["gallery-selection-view"]:a,{name:"outlet",hash:{},data:l}))+"\n\t\t\t\t"+o((e.outlet||a&&a.outlet||i).call(s,null!=a?a["gallery-creation-view"]:a,{name:"outlet",hash:{},data:l}))+"\n\t\t\t</div>\n"},11:function(t,a,e,n,l){var s,i=null!=a?a:{};return'\t\t\t<div class="tab-container" data-tab="group">\n\t\t\t\t'+t.escapeExpression((e.outlet||a&&a.outlet||e.helperMissing).call(i,null!=a?a["group-selection-view"]:a,{name:"outlet",hash:{},data:l}))+"\n"+(null!=(s=e.if.call(i,null!=a?a.inlineGroupCreation:a,{name:"if",hash:{},fn:t.program(12,l,0),inverse:t.noop,data:l}))?s:"")+"\t\t\t</div>\n"},12:function(t,a,e,n,l){return"\t\t\t\t\t"+t.escapeExpression((e.outlet||a&&a.outlet||e.helperMissing).call(null!=a?a:{},null!=a?a["group-creation-view"]:a,{name:"outlet",hash:{},data:l}))+"\n"},compiler:[7,">= 4.0.0"],main:function(t,a,e,n,l){var s,i=null!=a?a:{};return'<div class="add-to-stuff-container" tabindex="-1">\n\t<div class="nav">\n\t\t<div class="list-label">'+t.escapeExpression((e.intlMessage||a&&a.intlMessage||e.helperMissing).call(i,{name:"intlMessage",hash:{intlName:"add-to-stuff.ADD_TO_LABEL"},data:l}))+"</div>\n\t\t<ul>\n"+(null!=(s=e.if.call(i,null!=a?a.showAlbums:a,{name:"if",hash:{},fn:t.program(1,l,0),inverse:t.noop,data:l}))?s:"")+(null!=(s=e.if.call(i,null!=a?a.showGalleries:a,{name:"if",hash:{},fn:t.program(3,l,0),inverse:t.noop,data:l}))?s:"")+(null!=(s=e.if.call(i,null!=a?a.showGroups:a,{name:"if",hash:{},fn:t.program(5,l,0),inverse:t.noop,data:l}))?s:"")+'\t\t</ul>\n\t\t<svg class="close-x-button"><use xlink:href="#icon-close"></use></svg>\n\t</div>\n\t<div class="tab-content-container">\n\n'+(null!=(s=e.if.call(i,null!=a?a.showAlbums:a,{name:"if",hash:{},fn:t.program(7,l,0),inverse:t.noop,data:l}))?s:"")+"\n"+(null!=(s=e.if.call(i,null!=a?a.showGalleries:a,{name:"if",hash:{},fn:t.program(9,l,0),inverse:t.noop,data:l}))?s:"")+"\n"+(null!=(s=e.if.call(i,null!=a?a.showGroups:a,{name:"if",hash:{},fn:t.program(11,l,0),inverse:t.noop,data:l}))?s:"")+"\t</div>\n</div>\n"},useData:!0}),n={};t.Array.each([],function(a){var e=t.Template.get("hermes/"+a);e&&(n[a]=e)}),t.Template.register("hermes/add-to-stuff-view",function(a,l){return l=l||{},l.partials=l.partials?t.merge(n,l.partials):n,e(a,l)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("add-to-stuff-view",function(e){e.namespace("Views")[this.name]=e.Base.create("add-to-stuff-view",e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){return this.params=e,this.params.showAlbums=!1!==this.params.showAlbums,this.params.showGalleries=!1!==this.params.showGalleries,this.params.showGroups=!1!==this.params.showGroups,this.params.initialTab=this.params.initialTab||"album",this.initialTab=this.params.initialTab,this.params.inlineGroupCreation=this.params.inlineGroupCreation||!1,this.params.inlineAlbumCreation=void 0===this.params.inlineAlbumCreation||this.params.inlineAlbumCreation,this.params.inlineGalleryCreation=void 0===this.params.inlineGalleryCreation||this.params.inlineGalleryCreation,this.currentTabName="",this},subviewConfig:{"album-selection-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!1,additionalViewClasses:["stuff-selection-view"]},"gallery-selection-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!1,additionalViewClasses:["stuff-selection-view"]},"group-selection-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!1,additionalViewClasses:["stuff-selection-view"]},"album-creation-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!1,additionalViewClasses:["stuff-creation-view","hidden"]},"gallery-creation-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!1,additionalViewClasses:["stuff-creation-view","hidden"]},"group-creation-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!1,additionalViewClasses:["stuff-creation-view","hidden"]}},buildContainer:function(){return this.setContainerWithTemplate("add-to-stuff-view",{showAlbums:this.params.showAlbums,showGalleries:this.params.showGalleries,showGroups:this.params.showGroups,inlineGroupCreation:this.params.inlineGroupCreation}),this},activate:function(){var t=this.get("container");return this.nav=t.one(".nav"),this.firstTab=t.one(".tab-item"),this.registerEventHandler(this.nav.one("ul").on(["click","key"],this.handleNavClick.bind(this),"down:13")),this.registerEventHandler(this.nav.one(".close-x-button").on("click",this.handleCloseClick.bind(this))),this.registerEventHandler(e.on("addToStuff:hideNav",function(e){this.nav.hide()}.bind(this))),this.registerEventHandler(e.on("addToStuff:showNav",function(e){this.nav.show()}.bind(this))),this.registerEventHandler(e.on("addToStuff:showCreate",function(t){e.one("."+t.type+"-selection-view").addClass("hidden"),e.one("."+t.type+"-creation-view").removeClass("hidden"),this.nav.hide(),e.fire("addToStuff:createShown",{curationType:this.currentTabName}),this.fire("contentSizeChanged")}.bind(this))),this.registerEventHandler(e.on("addToStuff:hideCreate",function(t){e.one("."+t.type+"-selection-view").removeClass("hidden"),e.one("."+t.type+"-creation-view").addClass("hidden"),this.nav.show(),e.fire("addToStuff:createHidden",{curationType:this.currentTabName}),this.fire("contentSizeChanged")}.bind(this))),this.switchTabs(this.initialTab),this.registerEventHandler(t.on("keydown",this.handleKeyPress.bind(this))),this.registerEventHandler(t.delegate("focus",this.handleFocus.bind(this))),this},handleNavClick:function(e){var t;e.stopPropagation(),e.preventDefault(),e.target&&(t=e.target.ancestor("li",!0))&&this.switchTabs(t.get("dataset").tab)},switchTabs:function(e){var t=this,i=this.nav.one(".tab-item.selected"),n=this.nav.one(".tab-item[data-tab="+e+"]"),a=i?i.get("dataset").tab:null,r=this.get("container").one(".tab-content-container"),s=r.one(".tab-container[data-tab="+a+"]"),o=r.one(".tab-container[data-tab="+e+"]"),l=o.one(".stuff-selection-search");this.currentTabName=e,i&&(i.removeClass("selected"),s.removeClass("selected")),n.addClass("selected"),o.addClass("selected"),setTimeout(function(){t.fire("contentSizeChanged")},0),setTimeout(function(){l.focus()},10)},handleCloseClick:function(e){this.fire("readyToClose")},handleKeyPress:function(t){var i=t.keyCode,n=t.shiftKey,a=this.get("container").one(".tab-container.selected"),r=a.one(".done-button")||a.one(".create-button");9===i&&(n&&this.focusedItem===this.firstTab?(t.preventDefault(),r.focus()):n||this.focusedItem!==r||(t.preventDefault(),this.firstTab.focus())),e.fire("addToStuff:keyPressed",{curationType:this.currentTabName,evt:t})},handleFocus:function(e){this.focusedItem=e.target},onSubviewEvent:function(e,t){"readyToClose"===t[0].eventName&&this.fire("readyToClose")}},{ATTRS:{dismissOnCreate:{value:!1,validator:function(t,i){return e.AttributeHelpers.validateBoolean(t)},setter:function(t,i){return e.AttributeHelpers.coerceBoolean(t)}},dismissOnCreateAlbum:{value:!1,validator:function(t,i){return e.AttributeHelpers.validateBoolean(t)},setter:function(t,i){return e.AttributeHelpers.coerceBoolean(t)}},dismissOnCreateGallery:{value:!1,validator:function(t,i){return e.AttributeHelpers.validateBoolean(t)},setter:function(t,i){return e.AttributeHelpers.coerceBoolean(t)}},dismissOnCreateGroup:{value:!1,validator:function(t,i){return e.AttributeHelpers.validateBoolean(t)},setter:function(t,i){return e.AttributeHelpers.coerceBoolean(t)}},dismissOnSelect:{value:!1,validator:function(t,i){return e.AttributeHelpers.validateBoolean(t)},setter:function(t,i){return e.AttributeHelpers.coerceBoolean(t)}},dismissOnSelectAlbum:{value:!1,validator:function(t,i){return e.AttributeHelpers.validateBoolean(t)},setter:function(t,i){return e.AttributeHelpers.coerceBoolean(t)}},dismissOnSelectGallery:{value:!1,validator:function(t,i){return e.AttributeHelpers.validateBoolean(t)},setter:function(t,i){return e.AttributeHelpers.coerceBoolean(t)}},dismissOnSelectGroup:{value:!1,validator:function(t,i){return e.AttributeHelpers.validateBoolean(t)},setter:function(t,i){return e.AttributeHelpers.coerceBoolean(t)}},inlineGroupCreation:{value:!1,validator:function(t,i){return e.AttributeHelpers.validateBoolean(t)},setter:function(t,i){return e.AttributeHelpers.coerceBoolean(t)}},useLargeLayout:{value:!1,validator:function(t,i){return e.AttributeHelpers.validateBoolean(t)},setter:function(t,i){return e.AttributeHelpers.coerceBoolean(t)}}}})},"@VERSION@",{requires:["flickr-view","flickr-promise","hermes-template-add-to-stuff-view"],langBundles:["common","more-menu-view","add-to-stuff"]});